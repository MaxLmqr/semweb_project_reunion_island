<!DOCTYPE html>
<html>
	<head>
        <!-- CSS -->
		<link rel="stylesheet" href="style.css">
        <link rel="stylesheet" type="text/css" href="leaflet/leaflet.css"/>
        
        <!-- Javascript -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="leaflet/leaflet.js"></script>
        <script src="leaflet/leaflet.ajax.min.js"></script>
        <script src="main.js"></script>

        <!-- en-tête -->
        <title>Reunion Island</title>
        <meta charset="utf-8"/>
        
        <!-- police -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Acme&display=swap" rel="stylesheet"> 

	</head>
	<body>
        
        <div class = "wave-container">
            <br/><t2>Reunion Island</t2><br/>
            <t1>by Max and Thomas</t1>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 250"><path fill="#fff" fill-opacity="1" d="M0,128L48,144C96,160,192,192,288,192C384,192,480,160,576,133.3C672,107,768,85,864,106.7C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>
		</div>
        <div class = "page">
            <div class = "section">
                <div class = "sec-gauche" id = "forma-gauche">
                    <!--<h1>Carte intéractive</h1>-->
                    <div id="mapid">
                    </div>
                </div>
      

                <div class = "sec-droite">
                    
                        
                    <div id="menu" style="height: 550px; overflow:auto;  ">
                        <p id="label"><h1>Que recherche tu ?</h1></p>
                        <p>
                            <input type="checkbox" id="tourisme" />
                            <label for="tourisme" aria-describedby="label">Tourisme</label>
                        </p>
                        <p>
                            <input type="checkbox" id="test2"  />
                            <label for="test2" aria-describedby="label">Santé</label>
                        </p>
                        <p>
                            <input type="checkbox" id="test3" />
                            <label for="test3" aria-describedby="label">Transport</label>
                        </p>
                        <p>
                            <input type="checkbox" id="test4" />
                            <label for="test4" aria-describedby="label">Education</label>
                        </p>

                    

                </div>
            </div>
            <div class = "bottom">
                <br/>
                <h2>Contactez nous !</h2>
                <a target="_blank" href="https://www.linkedin.com/in/max-lemasquerier-a70a31175/">Max le boss</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a target="_blank" href="https://www.linkedin.com/in/thomas-de-lard/31175/">Thomas</a><br/><br/>
            </div>

        </div>

	<script>
		var mymap = L.map('mapid').setView([-21.117819, 55.521077], 10);
		
		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			//maxZoom: 18,
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1
		}).addTo(mymap);
		
		var geojsonLayer = new L.GeoJSON.AJAX("communes-millesimeespublic.geojson");       
		geojsonLayer.addTo(mymap);
		mymap.dragging.disable();
		mymap.touchZoom.disable();
		mymap.doubleClickZoom.disable();
		mymap.scrollWheelZoom.disable();
		mymap.boxZoom.disable();
		mymap.keyboard.disable();
		/*if (mymap.tap) mymap.tap.disable();
		document.getElementById('mapid').style.cursor='default';*/
		geojsonLayer.on("click", function (event) { // Assuming the clicked feature is a shape, not a point marker.
		mymap.fitBounds(event.layer.getBounds());
		mymap.setView([-21.117819, 55.521077], 10);
		});

		$('input[type="checkbox"]').each(function(){
  			$(this).prop('checked', false);
  		});
		var markers = new Array();
		$("#tourisme").on('click',function () {
			$(this).toggleClass("checked")
			queryTourismeUrl="http://localhost:3030/test/sparql?query=PREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0APREFIX+tm%3A+%3Chttp%3A%2F%2Fwww.thomasandmax.com%2F%3E%0A%0A%0ASELECT+%3Frandonnee+%3Flong+%3Flat%0AWHERE+%7B%0A++%3Frandonnee+rdf%3Atype+%3Chttp%3A%2F%2Fwww.thomasandmax.com%2FRandonnee%3E.%0A++%3Frandonnee+%3Chttp%3A%2F%2Fwww.thomasandmax.com%2Flong%3E+%3Flong.%0A++%3Frandonnee+%3Chttp%3A%2F%2Fwww.thomasandmax.com%2Flat%3E+%3Flat.%0A++FILTER+(%3Flong!%3D%220%22)%0A%0A++%0A%0A%7D%0ALIMIT+25&format=json"
			$.ajax({url:queryTourismeUrl,success: function(result) {
				if ($("#tourisme").hasClass("checked")) {
					result['results']['bindings'].forEach(element => {
						var marker = L.marker([element['lat']['value'],element['long']['value']]).addTo(mymap);
						markers.push(marker)
						var name = element['randonnee']['value'];
						marker.bindPopup(name.substring(name.lastIndexOf('/')+1).replaceAll("_"," ")).openPopup();
						mymap.closePopup();
					})
				} else {
					for (let i=0;i<markers.length;i++) {
						mymap.removeLayer(markers[i])
					}
					markers = []
				}
			}})
		console.log(markers)
		})
	</script>
    </body>     
</html>
